<%
const currentSort   = typeof sort !== "undefined" ? sort : "";
const currentSearch = typeof search !== "undefined" ? search : "";
const loggedIn      = typeof isLoggedIN !== "undefined" ? isLoggedIN : false;
// üîß FIX: safely handle undefined user (login/signup pages)
const safeUser      = typeof user !== "undefined" ? user : null;
const role          = safeUser && safeUser.role ? safeUser.role : null;
%>

<header class="sticky top-0 z-50 glass-nav">
  <nav class="max-w-7xl mx-auto flex items-center justify-between px-6 py-3 gap-6">

    <!-- LOGO -->
    <a href="/" class="flex items-center gap-2 select-none">
      <div class="bg-gradient-to-r from-rose-500 to-orange-400 p-2 rounded-xl shadow">
        <svg viewBox="0 0 32 32" class="w-6 h-6 fill-white">
          <path d="M16 6.6c-1.3 0-2.5.7-3.2 1.9L6.3 22c-1 1.7-.9 3.9.2 5.5 
           1.2 1.7 3.2 2.5 5.2 2.1 2-.4 3.6-2 4.1-4 
           .5 2 2.1 3.6 4.1 4 2 .4 4-.4 5.2-2.1 
           1.1-1.6 1.2-3.8.2-5.5L19.2 8.5c-.8-1.2-2-1.9-3.2-1.9z"/>
        </svg>
      </div>

      <span class="text-2xl font-extrabold bg-gradient-to-r from-rose-500 to-orange-400 
                   bg-clip-text text-transparent tracking-tight">
        Airbnb
      </span>

      <% if (loggedIn && role === 'host') { %>
        <span class="ml-2 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700">
          Host Dashboard
        </span>
      <% } %>
    </a>

    <!-- SEARCH (ONLY FOR GUEST) -->
    <% if (loggedIn && role === 'guest') { %>
    <form action="/homes" method="GET" class="flex-1 flex items-center gap-4 mx-6">
      <div class="w-full max-w-[600px] flex items-center gap-3 
                  bg-white/30 backdrop-blur-xl border border-white/30 
                  rounded-full px-5 py-2 shadow-lg">
        <input
          type="text"
          name="q"
          value="<%= currentSearch %>"
          placeholder="Search your dream stay‚Ä¶"
          class="w-full bg-transparent outline-none text-gray-800"
        />
        <button class="p-2 rounded-full bg-gradient-to-r from-rose-500 to-orange-400">
          üîç
        </button>
      </div>

      <select name="sort" class="px-4 py-2 rounded-full bg-white shadow">
        <option value="">Filter</option>
        <option value="price_asc"  <%= currentSort==="price_asc" ? "selected":"" %>>Price ‚Üë</option>
        <option value="price_desc" <%= currentSort==="price_desc" ? "selected":"" %>>Price ‚Üì</option>
        <option value="rating_desc" <%= currentSort==="rating_desc" ? "selected":"" %>>Rating</option>
      </select>

      <button class="px-4 py-2 rounded-full bg-gradient-to-r from-orange-400 to-rose-500 text-white">
        Apply
      </button>
    </form>
    <% } %>

    <!-- RIGHT NAV -->
    <div class="flex items-center gap-4">

      <!-- GUEST NAV -->
      <% if (loggedIn && role === 'guest') { %>
        <a href="/homes" class="navPremium">Homes</a>
        <a href="/favourites" class="navPremium">Favourites</a>
      <% } %>

      <!-- HOST DASHBOARD NAV -->
      <% if (loggedIn && role === 'host') { %>
        <a href="/host/host-homes" class="navDashboard">
          üè† <span>My Listings</span>
        </a>

        <a href="/host/add-home" class="navPrimary">
          ‚ûï <span>Add Home</span>
        </a>
      <% } %>

      <!-- AUTH -->
      <% if (loggedIn) { %>
        <form action="/logout" method="POST">
          <button class="btnLogout">Logout</button>
        </form>
      <% } else { %>
        <a href="/login" class="btnLogin">Login</a>
      <% } %>

    </div>
  </nav>
</header>

<style>
/* GLASS NAVBAR */
.glass-nav {
  background: rgba(255, 255, 255, 0.38);
  backdrop-filter: blur(22px) saturate(200%);
  border-bottom: 1.5px solid rgba(255, 255, 255, 0.45);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

/* GUEST LINKS */
.navPremium {
  position: relative;
  font-weight: 700;
  color: #333;
}

.navPremium:hover {
  color: #e11d48;
}

/* HOST DASHBOARD LINK */
.navDashboard {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 800;
  color: #0f172a;
  padding: 6px 10px;
  border-radius: 10px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
}

.navDashboard:hover {
  background: #eef2f7;
}

/* PRIMARY HOST ACTION */
.navPrimary {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 900;
  padding: 8px 16px;
  border-radius: 9999px;
  color: #fff;
  background: linear-gradient(to right, #e11d48, #fb923c);
  box-shadow: 0 8px 20px rgba(225, 29, 72, 0.35);
}

.navPrimary:hover {
  transform: translateY(-1px);
  box-shadow: 0 12px 28px rgba(225, 29, 72, 0.45);
}

/* AUTH BUTTONS */
.btnLogin {
  padding: 8px 16px;
  border-radius: 9999px;
  background: linear-gradient(to right, #e11d48, #fb923c);
  color: #fff;
  font-weight: 700;
}

.btnLogout {
  padding: 8px 16px;
  border-radius: 9999px;
  background: #0f172a;
  color: #fff;
  font-weight: 700;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  nav {
    flex-direction: column;
    gap: 14px;
  }
}
</style>